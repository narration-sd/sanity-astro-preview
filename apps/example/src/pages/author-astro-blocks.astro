---
import Layout from '../layouts/Layout.astro'
import { PreviewSubscription } from '@narration-sd/sanity-astro-preview'
import { PortableTextBlock } from '../components/react/PortableTextBlock'
import { sanityClient } from "sanity:client"
import { imageUrl, formatBlogPostDate} from '../utils/helpers'
import { clientConfig, kitConfig } from '../../previewKitConfig'
import { SanityImage, PortableText, PageTitle, RowHorizontalCaption,
  PageStatusDate, TextList } from '../components/react/SanityPreviewBlocks'
import '../styles/author.css'

const query = `*[_type == $type ][0]{ ... }`
const params = { type: 'author'}

// in a subject/[slug] page, you'd put your getStaticPaths here
const isPreview = Astro.url.searchParams.has('preview')
const options = isPreview && kitConfig.perspective
  ? { perspective: kitConfig.perspective }
  : {}
const liveLabel =  isPreview ? '(Preview)' : '(as Production Server)'
const pageData = await sanityClient.fetch(query, params, options)
  .catch(err => {
    throw new Error('astro-page:fetch error: ' + err)
  })
---
<Layout>
  <!-- you can add a 'show' prop, no value, to get on-page debugging -->
  <PreviewSubscription query={query} params={params}
    clientConfig={clientConfig} kitConfig={kitConfig}
    client:only="react"
  />

  <article class="theAuthor-preview__article">
    <PageTitle title="Author (in Astro Blocks)" note={liveLabel}
               live={isPreview} client:only="react" />
    <RowHorizontalCaption name={pageData.name}
               live={isPreview} client:only="react">
      <SanityImage pageData={pageData} dataField="image" live={isPreview}
        pipelineWidth={360} alt="Author's photo"
        styles={{imageStyle:{ maxWidth: '120px' }}} client:only="react" />
    </RowHorizontalCaption>
    <PageStatusDate pageData={pageData}/>
    <PortableText title="Bio (react)" pageData={pageData}
      live={isPreview}, dataField="bio" client:only="react" />
    <TextList pageData={pageData} dataField="contacts"
      live={isPreview} styleClass="contact" client:only="react"/>
  </article>
</Layout>
